<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>index db</h1>
</body>
<!-- <script>
    function openDB(name, version) {
        return new Promise((resolve, reject) => {
            let db
            const indexDB = window.indexedDB

            const request = indexDB.open(name, version)

            request.onsuccess = (event) => {
                db = event.target.result
                console.log('数据库连接成功', db);
                resolve(db)
            }

            request.onerror = (event) => {
                console.log('数据库连接失败，', event);
            }

            // 数据库有更新的时候的回调
            request.onupgradeneeded = (event) => {
                console.log("onupgradeneeded");

                db = event.target.result; // 数据库对象
                var objectStore;
                // 创建存储库
                objectStore = db.createObjectStore("signalChat", {
                    keyPath: "sequenceId", // 这是主键
                    autoIncrement: true // 实现自增
                });
                // 创建索引，在后面查询数据的时候可以根据索引查
                objectStore.createIndex("link", "link", {unique: false});
                objectStore.createIndex("sequenceId", "sequenceId", {unique: false});
                objectStore.createIndex("messageType", "messageType", {
                    unique: false,
                });

            }
        })
    }

    function addData(db, storeName, data) {
        console.log('data', data);
        const request = db.transaction([storeName], 'readwrite')
            .objectStore(storeName)
            .add(data)

        request.onsuccess = function (event) {
            console.log("数据写入成功", event);
        };

        request.onerror = function (event) {
            console.log("数据写入失败", event);
        };

    }

    function closeDB(db) {
        db.close()
        console.log('关闭数据库');
    }

    openDB('lhr', 2).then((db) => {
        addData(db, 'signalChat', {
            link: 'xxxyy',
            sequenceId: '44',
            messageType: 'xxx'
        })
        return db
    }).then((db) => {
        setTimeout(() => {
            closeDB(db)
        }, 1000)
    })


</script> -->

</html>